

<!--
Documentation generated by Skydoc
-->
<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width initial-scale=1" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <title>Jsonnet Rules</title>

    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,600,700" type="text/css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <link rel="stylesheet" href="https://code.getmdl.io/1.1.1/material.green-light_blue.min.css">
    <script defer src="https://code.getmdl.io/1.1.1/material.min.js"></script>
    <link rel="stylesheet" href="https://bazelbuild.github.io/rules_jsonnet/main.css">
  </head>
  <body>
    <div class="mdl-layout mdl-js-layout mdl-layout--fixed-drawer
      mdl-layout--fixed-header">
      <header class="mdl-layout__header">
        <div class="mdl-layout__header-row">
          <span class="mdl-layout-title">Jsonnet Rules</span>
        </div>
      </header>
      <div class="mdl-layout__drawer">
        <span class="mdl-layout-title">Bazel</span>
        <nav class="drawer-nav">
          <ul class="drawer-nav">
            
<li><a href="https://bazelbuild.github.io/rules_jsonnet/index.html">Overview</a></li>
<li>
  <a href="https://bazelbuild.github.io/rules_jsonnet/jsonnet/jsonnet.html">Jsonnet Rules</a>
  <ul>
    <li><a href="https://bazelbuild.github.io/rules_jsonnet/jsonnet/jsonnet.html#overview">Overview</a></li>
    <li>
      <a href="https://bazelbuild.github.io/rules_jsonnet/jsonnet/jsonnet.html#jsonnet_library">
        jsonnet_library
      </a>
    </li>
    <li>
      <a href="https://bazelbuild.github.io/rules_jsonnet/jsonnet/jsonnet.html#jsonnet_to_json">
        jsonnet_to_json
      </a>
    </li>
    <li>
      <a href="https://bazelbuild.github.io/rules_jsonnet/jsonnet/jsonnet.html#jsonnet_to_json_test">
        jsonnet_to_json_test
      </a>
    </li>
  </ul>
</li>

          </ul>
        </nav>
      </div>

      <main class="mdl-layout__content">
        <div class="page-content">
          <h1>Jsonnet Rules</h1>

<nav class="toc">
  <h2><a href="#overview">Overview</a></h2>
  <h2>Rules</h2>
  <ul>
    <li><a href="#jsonnet_library">jsonnet_library</a></li>
    <li><a href="#jsonnet_to_json">jsonnet_to_json</a></li>
    <li><a href="#jsonnet_to_json_test">jsonnet_to_json_test</a></li>
  </ul>
  <h2>Macros</h2>
  <ul>
    <li><a href="#jsonnet_repositories">jsonnet_repositories</a></li>
  </ul>
</nav>
          <hr>
          <h2 id="overview">Overview</h2>
          <p>These are build rules for working with <a href="http://google.github.io/jsonnet/doc/">Jsonnet</a> files with Bazel.</p>
<h2>Setup</h2>
<p>To use the Jsonnet rules, add the following to your <code>WORKSPACE</code> file to add the
external repositories for Jsonnet:</p>
<pre><code class="lang-python">http_archive(
    name = &quot;io_bazel_rules_jsonnet&quot;,
    url = &quot;https://github.com/bazelbuild/rules_jsonnet/archive/0.0.2.tar.gz&quot;,
    sha256 = &quot;5f788c7719a02ed2483641365f194e9e5340fbe54963d6d6caa09f91454d38b8&quot;,
    strip_prefix = &quot;rules_jsonnet-0.0.2&quot;,
)
load(&quot;@io_bazel_rules_jsonnet//jsonnet:jsonnet.bzl&quot;, &quot;jsonnet_repositories&quot;)

jsonnet_repositories()
</code></pre>

          <hr>

          <h2 id="jsonnet_repositories">jsonnet_repositories</h2>

          <pre>jsonnet_repositories()</pre>

          <p>Adds the external dependencies needed for the Jsonnet rules.</p>


          <hr>

          <h2 id="jsonnet_library">jsonnet_library</h2>

          <pre>jsonnet_library(<a href="#jsonnet_library.name">name</a>, <a href="#jsonnet_library.deps">deps</a>, <a href="#jsonnet_library.data">data</a>, <a href="#jsonnet_library.srcs">srcs</a>, <a href="#jsonnet_library.imports">imports</a>, <a href="#jsonnet_library.jsonnet">jsonnet</a>)</pre>

          <p>Creates a logical set of Jsonnet files.</p>


          <h3 id="jsonnet_library_args">Attributes</h3>

<table class="params-table">
  <colgroup>
    <col class="col-param" />
    <col class="col-description" />
  </colgroup>
  <tbody>
    <tr id="jsonnet_library.name">
      <td><code>name</code></td>
      <td>
        <p><code><a href="https://bazel.build/docs/build-ref.html#name">Name</a>; Required</code></p>
        <p>A unique name for this rule.</p>
      </td>
    </tr>
    <tr id="jsonnet_library.deps">
      <td><code>deps</code></td>
      <td>
        <p><code>List of <a href="https://bazel.build/docs/build-ref.html#labels">labels</a>; Optional; Default is []</code></p>
        <p>List of targets that are required by the <code>src</code> Jsonnet file.</p>
      </td>
    </tr>
    <tr id="jsonnet_library.data">
      <td><code>data</code></td>
      <td>
        <p><code>List of <a href="https://bazel.build/docs/build-ref.html#labels">labels</a>; Optional; Default is []</code></p>
        
      </td>
    </tr>
    <tr id="jsonnet_library.srcs">
      <td><code>srcs</code></td>
      <td>
        <p><code>List of <a href="https://bazel.build/docs/build-ref.html#labels">labels</a>; Optional; Default is []</code></p>
        <p>List of <code>.jsonnet</code> files that comprises this Jsonnet library.</p>
      </td>
    </tr>
    <tr id="jsonnet_library.imports">
      <td><code>imports</code></td>
      <td>
        <p><code>List of strings; Optional; Default is []</code></p>
        <p>List of import <code>-J</code> flags to be passed to the <code>jsonnet</code> compiler.</p>
      </td>
    </tr>
    <tr id="jsonnet_library.jsonnet">
      <td><code>jsonnet</code></td>
      <td>
        <p><code><a href="https://bazel.build/docs/build-ref.html#labels">Label</a>; Optional; Default is @jsonnet//cmd:jsonnet</code></p>
        
      </td>
    </tr>
  </tbody>
</table>
          <h3 id="jsonnet_library_examples">Examples</h3>
          <p>Suppose you have the following directory structure:</p>
<pre><code>[workspace]/
    WORKSPACE
    configs/
        BUILD
        backend.jsonnet
        frontend.jsonnet
</code></pre>
<p>You can use the <code>jsonnet_library</code> rule to build a collection of <code>.jsonnet</code>
files that can be imported by other <code>.jsonnet</code> files as dependencies:</p>
<p><code>configs/BUILD</code>:</p>
<pre><code class="lang-python">load(&quot;@io_bazel_rules_jsonnet//jsonnet:jsonnet.bzl&quot;, &quot;jsonnet_library&quot;)

jsonnet_library(
    name = &quot;configs&quot;,
    srcs = [
        &quot;backend.jsonnet&quot;,
        &quot;frontend.jsonnet&quot;,
    ],
)
</code></pre>

          <hr>

          <h2 id="jsonnet_to_json">jsonnet_to_json</h2>

          <pre>jsonnet_to_json(<a href="#jsonnet_to_json.name">name</a>, <a href="#jsonnet_to_json.deps">deps</a>, <a href="#jsonnet_to_json.src">src</a>, <a href="#jsonnet_to_json.data">data</a>, <a href="#jsonnet_to_json.outs">outs</a>, <a href="#jsonnet_to_json.code_vars">code_vars</a>, <a href="#jsonnet_to_json.imports">imports</a>, <a href="#jsonnet_to_json.jsonnet">jsonnet</a>, <a href="#jsonnet_to_json.multiple_outputs">multiple_outputs</a>, <a href="#jsonnet_to_json.vars">vars</a>)</pre>

          <p>Compiles Jsonnet code to JSON.</p>


          <h3 id="jsonnet_to_json_args">Attributes</h3>

<table class="params-table">
  <colgroup>
    <col class="col-param" />
    <col class="col-description" />
  </colgroup>
  <tbody>
    <tr id="jsonnet_to_json.name">
      <td><code>name</code></td>
      <td>
        <p><code><a href="https://bazel.build/docs/build-ref.html#name">Name</a>; Required</code></p>
        <p>A unique name for this rule.</p>
<p>This name will be used as the name of the JSON file generated by this rule.</p>
      </td>
    </tr>
    <tr id="jsonnet_to_json.deps">
      <td><code>deps</code></td>
      <td>
        <p><code>List of <a href="https://bazel.build/docs/build-ref.html#labels">labels</a>; Optional; Default is []</code></p>
        <p>List of targets that are required by the <code>src</code> Jsonnet file.</p>
      </td>
    </tr>
    <tr id="jsonnet_to_json.src">
      <td><code>src</code></td>
      <td>
        <p><code><a href="https://bazel.build/docs/build-ref.html#labels">Label</a>; Optional</code></p>
        <p>The <code>.jsonnet</code> file to convert to JSON.</p>
      </td>
    </tr>
    <tr id="jsonnet_to_json.data">
      <td><code>data</code></td>
      <td>
        <p><code>List of <a href="https://bazel.build/docs/build-ref.html#labels">labels</a>; Optional; Default is []</code></p>
        
      </td>
    </tr>
    <tr id="jsonnet_to_json.outs">
      <td><code>outs</code></td>
      <td>
        <p><code>List of outputs; Required</code></p>
        <p>Names of the output <code>.json</code> files to be generated by this rule.</p>
<p>If you are generating only a single JSON file and are not using jsonnet
multiple output files, then this attribute should only contain the file
name of the JSON file you are generating.</p>
<p>If you are generating multiple JSON files using jsonnet multiple file output
(<code>jsonnet -m</code>), then list the file names of all the JSON files to be
generated. The file names specified here must match the file names
specified in your <code>src</code> Jsonnet file.</p>
<p>For the case where multiple file output is used but only for generating one
output file, set the <code>multiple_outputs</code> attribute to 1 to explicitly enable
the <code>-m</code> flag for multiple file output.</p>
      </td>
    </tr>
    <tr id="jsonnet_to_json.code_vars">
      <td><code>code_vars</code></td>
      <td>
        <p><code>Dictionary mapping strings to string; Optional; Default is {}</code></p>
        <p>Map of code variables to pass to jsonnet via <code>--code-var key-value</code>
flags.</p>
      </td>
    </tr>
    <tr id="jsonnet_to_json.imports">
      <td><code>imports</code></td>
      <td>
        <p><code>List of strings; Optional; Default is []</code></p>
        <p>List of import <code>-J</code> flags to be passed to the <code>jsonnet</code> compiler.</p>
      </td>
    </tr>
    <tr id="jsonnet_to_json.jsonnet">
      <td><code>jsonnet</code></td>
      <td>
        <p><code><a href="https://bazel.build/docs/build-ref.html#labels">Label</a>; Optional; Default is @jsonnet//cmd:jsonnet</code></p>
        
      </td>
    </tr>
    <tr id="jsonnet_to_json.multiple_outputs">
      <td><code>multiple_outputs</code></td>
      <td>
        <p><code>Boolean; Optional; Default is False</code></p>
        <p>Set to 1 to explicitly enable multiple file output via the
<code>jsonnet -m</code> flag.</p>
<p>This is used for the case where multiple file output is used but only for
generating a single output file. For example:</p>
<pre><code>local foo = import "foo.jsonnet";

{
"foo.json": foo,
}
</code></pre>
      </td>
    </tr>
    <tr id="jsonnet_to_json.vars">
      <td><code>vars</code></td>
      <td>
        <p><code>Dictionary mapping strings to string; Optional; Default is {}</code></p>
        <p>Map of variables to pass to jsonnet via <code>--var key=value</code> flags.</p>
      </td>
    </tr>
  </tbody>
</table>
          <h3 id="jsonnet_to_json_examples">Examples</h3>
          <h3>Example</h3>
<p>Suppose you have the following directory structure:</p>
<pre><code>[workspace]/
    WORKSPACE
    workflows/
        BUILD
        workflow.libsonnet
        wordcount.jsonnet
        intersection.jsonnet
</code></pre>
<p>Say that <code>workflow.libsonnet</code> is a base configuration library for a workflow
scheduling system and <code>wordcount.jsonnet</code> and <code>intersection.jsonnet</code> both
import <code>workflow.libsonnet</code> to define workflows for performing a wordcount and
intersection of two files, respectively.</p>
<p>First, create a <code>jsonnet_library</code> target with <code>workflow.libsonnet</code>:</p>
<p><code>workflows/BUILD</code>:</p>
<pre><code class="lang-python">load(&quot;@io_bazel_rules_jsonnet//jsonnet:jsonnet.bzl&quot;, &quot;jsonnet_library&quot;)

jsonnet_library(
    name = &quot;workflow&quot;,
    srcs = [&quot;workflow.libsonnet&quot;],
)
</code></pre>
<p>To compile <code>wordcount.jsonnet</code> and <code>intersection.jsonnet</code> to JSON, define two
<code>jsonnet_to_json</code> targets:</p>
<pre><code class="lang-python">jsonnet_to_json(
    name = &quot;wordcount&quot;,
    src = &quot;wordcount.jsonnet&quot;,
    outs = [&quot;wordcount.json&quot;],
    deps = [&quot;:workflow&quot;],
)

jsonnet_to_json(
    name = &quot;intersection&quot;,
    src = &quot;intersection.jsonnet&quot;,
    outs = [&quot;intersection.json&quot;],
    deps = [&quot;:workflow&quot;],
)
</code></pre>
<h3>Example: Multiple output files</h3>
<p>To use Jsonnet's <a href="http://google.github.io/jsonnet/doc/commandline.html">multiple output files</a>, suppose you
add a file <code>shell-workflows.jsonnet</code> that imports <code>wordcount.jsonnet</code> and
<code>intersection.jsonnet</code>:</p>
<p><code>workflows/shell-workflows.jsonnet</code>:</p>
<pre><code>local wordcount = import "workflows/wordcount.jsonnet";
local intersection = import "workflows/intersection.jsonnet";

{
  "wordcount-workflow.json": wordcount,
  "intersection-workflow.json": intersection,
}
</code></pre>
<p>To compile <code>shell-workflows.jsonnet</code> into the two JSON files,
<code>wordcount-workflow.json</code> and <code>intersection-workflow.json</code>, first create a
<code>jsonnet_library</code> target containing the two files that
<code>shell-workflows.jsonnet</code> depends on:</p>
<pre><code class="lang-python">jsonnet_library(
    name = &quot;shell-workflows-lib&quot;,
    srcs = [
        &quot;wordcount.jsonnet&quot;,
        &quot;intersection.jsonnet&quot;,
    ],
    deps = [&quot;:workflow&quot;],
)
</code></pre>
<p>Then, create a <code>jsonnet_to_json</code> target and set <code>outs</code> to the list of output
files to indicate that multiple output JSON files are generated:</p>
<pre><code class="lang-python">jsonnet_to_json(
    name = &quot;shell-workflows&quot;,
    src = &quot;shell-workflows.jsonnet&quot;,
    deps = [&quot;:shell-workflows-lib&quot;],
    outs = [
        &quot;wordcount-workflow.json&quot;,
        &quot;intersection-workflow.json&quot;,
    ],
)
</code></pre>

          <hr>

          <h2 id="jsonnet_to_json_test">jsonnet_to_json_test</h2>

          <pre>jsonnet_to_json_test(<a href="#jsonnet_to_json_test.name">name</a>, <a href="#jsonnet_to_json_test.deps">deps</a>, <a href="#jsonnet_to_json_test.src">src</a>, <a href="#jsonnet_to_json_test.data">data</a>, <a href="#jsonnet_to_json_test.code_vars">code_vars</a>, <a href="#jsonnet_to_json_test.error">error</a>, <a href="#jsonnet_to_json_test.golden">golden</a>, <a href="#jsonnet_to_json_test.imports">imports</a>, <a href="#jsonnet_to_json_test.jsonnet">jsonnet</a>, <a href="#jsonnet_to_json_test.regex">regex</a>, <a href="#jsonnet_to_json_test.vars">vars</a>)</pre>

          <p>Compiles Jsonnet code to JSON and checks the output.</p>


          <h3 id="jsonnet_to_json_test_args">Attributes</h3>

<table class="params-table">
  <colgroup>
    <col class="col-param" />
    <col class="col-description" />
  </colgroup>
  <tbody>
    <tr id="jsonnet_to_json_test.name">
      <td><code>name</code></td>
      <td>
        <p><code><a href="https://bazel.build/docs/build-ref.html#name">Name</a>; Required</code></p>
        <p>A unique name for this rule.</p>
<p>This name will be used as the name of the JSON file generated by this rule.</p>
      </td>
    </tr>
    <tr id="jsonnet_to_json_test.deps">
      <td><code>deps</code></td>
      <td>
        <p><code>List of <a href="https://bazel.build/docs/build-ref.html#labels">labels</a>; Optional; Default is []</code></p>
        <p>List of targets that are required by the <code>src</code> Jsonnet file.</p>
      </td>
    </tr>
    <tr id="jsonnet_to_json_test.src">
      <td><code>src</code></td>
      <td>
        <p><code><a href="https://bazel.build/docs/build-ref.html#labels">Label</a>; Optional</code></p>
        <p>The <code>.jsonnet</code> file to convert to JSON.</p>
      </td>
    </tr>
    <tr id="jsonnet_to_json_test.data">
      <td><code>data</code></td>
      <td>
        <p><code>List of <a href="https://bazel.build/docs/build-ref.html#labels">labels</a>; Optional; Default is []</code></p>
        
      </td>
    </tr>
    <tr id="jsonnet_to_json_test.code_vars">
      <td><code>code_vars</code></td>
      <td>
        <p><code>Dictionary mapping strings to string; Optional; Default is {}</code></p>
        <p>Map of code variables to pass to jsonnet via <code>--code-var key-value</code>
flags.</p>
      </td>
    </tr>
    <tr id="jsonnet_to_json_test.error">
      <td><code>error</code></td>
      <td>
        <p><code>Integer; Optional; Default is 0</code></p>
        <p>The expected error code from running <code>jsonnet</code> on <code>src</code>.</p>
      </td>
    </tr>
    <tr id="jsonnet_to_json_test.golden">
      <td><code>golden</code></td>
      <td>
        <p><code><a href="https://bazel.build/docs/build-ref.html#labels">Label</a>; Optional</code></p>
        <p>The expected (combined stdout and stderr) output to compare to the
output of running <code>jsonnet</code> on <code>src</code>.</p>
      </td>
    </tr>
    <tr id="jsonnet_to_json_test.imports">
      <td><code>imports</code></td>
      <td>
        <p><code>List of strings; Optional; Default is []</code></p>
        <p>List of import <code>-J</code> flags to be passed to the <code>jsonnet</code> compiler.</p>
      </td>
    </tr>
    <tr id="jsonnet_to_json_test.jsonnet">
      <td><code>jsonnet</code></td>
      <td>
        <p><code><a href="https://bazel.build/docs/build-ref.html#labels">Label</a>; Optional; Default is @jsonnet//cmd:jsonnet</code></p>
        
      </td>
    </tr>
    <tr id="jsonnet_to_json_test.regex">
      <td><code>regex</code></td>
      <td>
        <p><code>Boolean; Optional; Default is False</code></p>
        <p>Set to 1 if <code>golden</code> contains a regex used to match the output of
running <code>jsonnet</code> on <code>src</code>.</p>
      </td>
    </tr>
    <tr id="jsonnet_to_json_test.vars">
      <td><code>vars</code></td>
      <td>
        <p><code>Dictionary mapping strings to string; Optional; Default is {}</code></p>
        <p>Map of variables to pass to jsonnet via <code>--var key=value</code> flags.</p>
      </td>
    </tr>
  </tbody>
</table>
          <h3 id="jsonnet_to_json_test_examples">Examples</h3>
          <p>Suppose you have the following directory structure:</p>
<pre><code>[workspace]/
    WORKSPACE
    config/
        BUILD
        base_config.libsonnet
        test_config.jsonnet
        test_config.json
</code></pre>
<p>Suppose that <code>base_config.libsonnet</code> is a library Jsonnet file, containing the
base configuration for a service. Suppose that <code>test_config.jsonnet</code> is a test
configuration file that is used to test <code>base_config.jsonnet</code>, and
<code>test_config.json</code> is the expected JSON output from compiling
<code>test_config.jsonnet</code>.</p>
<p>The <code>jsonnet_to_json_test</code> rule can be used to verify that compiling a Jsonnet
file produces the expected JSON output. Simply define a <code>jsonnet_to_json_test</code>
target and provide the input test Jsonnet file and the <code>golden</code> file containing
the expected JSON output:</p>
<p><code>config/BUILD</code>:</p>
<pre><code class="lang-python">load(
    &quot;@io_bazel_rules_jsonnet//jsonnet:jsonnet.bzl&quot;,
    &quot;jsonnet_library&quot;,
    &quot;jsonnet_to_json_test&quot;,
)

jsonnet_library(
    name = &quot;base_config&quot;,
    srcs = [&quot;base_config.libsonnet&quot;],
)

jsonnet_to_json_test(
    name = &quot;test_config_test&quot;,
    src = &quot;test_config&quot;,
    deps = [&quot;:base_config&quot;],
    golden = &quot;test_config.json&quot;,
)
</code></pre>
<p>To run the test: <code>bazel test //config:test_config_test</code></p>
<h3>Example: Negative tests</h3>
<p>Suppose you have the following directory structure:</p>
<pre><code>[workspace]/
    WORKSPACE
    config/
        BUILD
        base_config.libsonnet
        invalid_config.jsonnet
        invalid_config.output
</code></pre>
<p>Suppose that <code>invalid_config.jsonnet</code> is a Jsonnet file used to verify that
an invalid config triggers an assertion in <code>base_config.jsonnet</code>, and
<code>invalid_config.output</code> is the expected error output.</p>
<p>The <code>jsonnet_to_json_test</code> rule can be used to verify that compiling a Jsonnet
file results in an expected error code and error output. Simply define a
<code>jsonnet_to_json_test</code> target and provide the input test Jsonnet file, the
expected error code in the <code>error</code> attribute, and the <code>golden</code> file containing
the expected error output:</p>
<p><code>config/BUILD</code>:</p>
<pre><code class="lang-python">load(
    &quot;@io_bazel_rules_jsonnet//jsonnet:jsonnet.bzl&quot;,
    &quot;jsonnet_library&quot;,
    &quot;jsonnet_to_json_test&quot;,
)

jsonnet_library(
    name = &quot;base_config&quot;,
    srcs = [&quot;base_config.libsonnet&quot;],
)

jsonnet_to_json_test(
    name = &quot;invalid_config_test&quot;,
    src = &quot;invalid_config&quot;,
    deps = [&quot;:base_config&quot;],
    golden = &quot;invalid_config.output&quot;,
    error = 1,
)
</code></pre>
<p>To run the test: <code>bazel test //config:invalid_config_test</code></p>



        </div>

        <footer class="mdl-mini-footer">
          <div class="mdl-mini-footer__left-section">
            <div class="mdl-logo">Bazel</div>
            <ul class="mdl-mini-footer__link-list">
              <li><a href="http://bazel.io">Home</a></li>
              <li><a href="https://github.com/bazelbuild">GitHub</a></li>
            </ul>
          </div>
        </footer>
      </main>
    </div>
  </body>
</html>
